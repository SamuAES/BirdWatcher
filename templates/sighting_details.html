{% extends "layout.html" %}
{% block content %}

{% if session.user_id %}

<h1>Sighting info</h1>
<hr>

<!-- Sighting info. -->
<p>
    <i>User:</i> <a href="/profile/{{sighting.username}}">{{ sighting.username }}</a>
</p>
<p>
    <i>Bird:</i> {{ sighting.bird_name }}
</p>
<p>
    Bird details:
    <ul>
        <li>Order: {{bird_details.orders}} </li>
        <li>Family (scientific): {{bird_details.family_sci}}</li>
        <li>Family: {{bird_details.family_en}}</li>
        <li>Genus: {{bird_details.genus}}</li>
        <li>Species (scientific): {{bird_details.species_sci}}</li>
        <li>Authority: {{bird_details.authority}}</li>
        <li>Breeding range: {{bird_details.breeding_range}}
            {% if bird_details.breeding_range_subregions %}
                ({{bird_details.breeding_range_subregions}})
            {% endif %}
        </li>
        {% if bird_details.nonbreeding_range %}
            <li>Nonbreeding range: {{bird_details.nonbreeding_range}}</li>
        {% endif %}
    </ul>
</p>
<p>
    <!-- sighting[2] is 'time' and sightings.time... cause error. -->
    <i>Date and time:</i> {{ sighting[2].strftime("%Y-%m-%d %H:%M") }}
</p>
<p>
    <i>Location:</i> {{sighting.location}}
</p>
<p>
    <i>Additional info:</i> {{sighting.additional_info}}
</p>
<p>
    {% if image %}
        <img src="data:image/jpg;base64,{{image}}">
    {% endif %}
</p>

<!-- Admin, moderator or user who posted the sighting can delete it. -->
{% if session.username == sighting.username or session.moderator or session.admin %}
<form action="/sighting/{{id}}" method="post">
    <input type="hidden" name="sighting_id" value="{{id}}">
    <p>
        <input type="submit" value="Delete sighting">
    </p>
</form>
{% endif %}
<h2>Comments:</h2>
{% for comment in comments %}

    <ul>
    <li><i>user:</i> <a href="/profile/{{comment.username}}"> {{comment.username}} </a>

    <li><i>comment:</i> {{comment.content}}

    <li><i>Sent at:</i> {{ comment.sent_at.strftime("%Y-%m-%d %H:%M") }}
    </ul>

    <!-- Admin, moderator or user who posted the comment can delete it. -->
    {% if session.username == comment.username or session.moderator or session.admin %}
        <form action="/sighting/{{id}}" method="post">
            <input type="hidden" name="comment_id" value="{{comment.id}}">
            <input type="submit" value="Delete comment">
        </form>
    {% endif %}


{% endfor %}
<p>
    <!-- Make new comment. -->
    <form action="/sighting/{{id}}" method="post">
        <input type="hidden" name="sighting_id" value="{{id}}">
        <p>
        <textarea name="new_comment" rows="3" cols="40"></textarea>
        </p>
        <input type="submit" value="Add comment">
    </form>
</p>



<hr>

{% else %}

Log in to see details about the sighting!

{% endif %}





{% endblock %}